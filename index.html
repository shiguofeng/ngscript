<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ngscript by wssccc</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>ngscript</h1>
        <p>the ngscript programming language</p>
        <p class="view"><a href="https://github.com/wssccc/ngscript">View the Project on GitHub <small>wssccc/ngscript</small></a></p>
        <ul>
          <li><a href="https://github.com/wssccc/ngscript/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/wssccc/ngscript/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/wssccc/ngscript">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="ngscript-an-overview" class="anchor" href="#ngscript-an-overview"><span class="octicon octicon-link"></span></a>ngscript: An overview</h1>

<p><a href="https://travis-ci.org/wssccc/ngscript"><img src="https://travis-ci.org/wssccc/ngscript.svg?branch=master" alt="Build Status"></a></p>

<h2>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>ngscript is an embedded script language for Java. It has almost the same features as Javascript, in addition, ngscript provides an elegant way to interact with native Java classes and objects. 
Examples in this text are ready to run on <a href="http://shell.ngscript.org/">http://shell.ngscript.org/</a> (or <a href="http://ngscript.sinaapp.com">http://ngscript.sinaapp.com</a> for faster access), except some related to IO operation.
The "VM" mentioned below, if no special emphasis, is ngscript's WscVM.</p>

<h2>
<a name="language-elements" class="anchor" href="#language-elements"><span class="octicon octicon-link"></span></a>Language elements</h2>

<h3>
<a name="variable" class="anchor" href="#variable"><span class="octicon octicon-link"></span></a>Variable</h3>

<p>To define a variable, use <code>var</code> statement. 
<strong>Please notice that if you don't initialize the variable once it is declared, ngscript doesn't guarantee the content in it.</strong></p>

<blockquote>
<p><strong>Here are some examples</strong></p>

<p>Define a variable named as var_name</p>

<pre><code>  var var_name;
</code></pre>

<p>Inline definition</p>

<pre><code>  for (var i = 0; i &lt; 9; ++i) ...
</code></pre>
</blockquote>

<p>Variables in ngscript seems typeless, in fact, they are all stored as Object in the VM. 
Primitive types are auto-boxed, but if you call a native method that requires primitive types, the VM unbox primitives automatically.</p>

<h3>
<a name="function" class="anchor" href="#function"><span class="octicon octicon-link"></span></a>Function</h3>

<h4>
<a name="named-function" class="anchor" href="#named-function"><span class="octicon octicon-link"></span></a>Named function</h4>

<p>Named function is declared like</p>

<pre><code>    function func1 (param1, param2) {
        println(param1 + "," + param2);
    }
</code></pre>

<p>You might as well notice that <strong>named functions are registered in global scope</strong>.</p>

<h4>
<a name="lambda" class="anchor" href="#lambda"><span class="octicon octicon-link"></span></a>Lambda</h4>

<p>ngscript supports anonymous function, the underlying implements of named function is a variable that stores an anonymous function along with global environment.</p>

<blockquote>
<p>Invoking lambda</p>

<pre><code>  (function (){
      println("hello");
  })();
</code></pre>

<p>Use a variable to store lambda</p>

<pre><code>  var f = function(){
      println("hello, stored lambda");
  };
</code></pre>
</blockquote>

<h4>
<a name="native-closure" class="anchor" href="#native-closure"><span class="octicon octicon-link"></span></a>Native closure</h4>

<p>It's known to all that object is a combination of <code>DATA</code> and <code>PROCESS</code>. The central concept of OOP is the <code>DATA</code> stored in members and the <code>PROCESS</code> defined as methods.</p>

<p>The other way around, if <code>DATA</code> stores in environment(or enclosure variable), <code>PROCESS</code> is just a single function, obviously, the combination of <code>DATA</code> and <code>PROCESS</code> is called function closure.</p>

<p>So ngscript provides a different way to reference native objects, that is what I called "Native closure".</p>

<blockquote>
<p>When we're making reference to native Java's object method, the VM creates a native closure to store it.</p>

<pre><code>  //native Java ArrayList
  var array = new ArrayList();
  //add something
  array.add(1); array.add(2); array.add(3);
  //reference to method of a native object
  var ref_get = array.get;
  //call the reference to get the element of index 1
  println(ref_get(1));
</code></pre>
</blockquote>

<p><em>ngscript's native closure also supports function overriding</em></p>

<h3>
<a name="object" class="anchor" href="#object"><span class="octicon octicon-link"></span></a>Object</h3>

<p>ngscript's object system is based on environment and closure, and without annoying things like prototype and dynamic scoping.</p>

<h4>
<a name="ngscript-object" class="anchor" href="#ngscript-object"><span class="octicon octicon-link"></span></a>ngscript object</h4>

<blockquote>
<p>Define a constructor is like define a named function</p>

<pre><code>  function One(name) {
      this.hiho = function(){
          println("I'm " + name);
      };
  }
</code></pre>

<p>Create an object with <code>new</code> operator</p>

<pre><code>  var newone = new One("wssccc");
  newone.hiho();
</code></pre>

<p>Or you can use the empty constructor </p>

<pre><code>  var otherone = new Object();
  otherone.hiho = newone.hiho;
  otherone.hiho();
</code></pre>
</blockquote>

<h4>
<a name="native-java-support" class="anchor" href="#native-java-support"><span class="octicon octicon-link"></span></a>Native Java support</h4>

<p>Native Java Classes are also available.</p>

<blockquote>
<p>Create an instance of ArrayList</p>

<pre><code>  var arraylist = new ArrayList();
  arraylist.add(1);
  arraylist.add(2);
  println(arraylist.toString());
  arraylist.remove(0);
  println(arraylist.toString());
</code></pre>
</blockquote>

<h4>
<a name="import-java-class" class="anchor" href="#import-java-class"><span class="octicon octicon-link"></span></a>Import Java class</h4>

<p>java.lang.* and java.util.* are imported by default.
ngscript supports <code>import</code> statement, but it's not fully tested yet.</p>

<h3>
<a name="typeof" class="anchor" href="#typeof"><span class="octicon octicon-link"></span></a>typeof</h3>

<p><code>typeof</code> is an operator to retrieve the type information of data. The return value is a string.</p>

<blockquote>
<pre><code>  println(typeof println);
  var a = 1;
  println(typeof a);
  println(typeof println);
</code></pre>
</blockquote>

<h3>
<a name="println" class="anchor" href="#println"><span class="octicon octicon-link"></span></a>println</h3>

<p>println is to print a line.</p>

<h3>
<a name="eval" class="anchor" href="#eval"><span class="octicon octicon-link"></span></a>eval</h3>

<p>eval takes one string parameter, the string can be a valid expression or statements. 
eval executes the code, and return the %eax once the VM returned.</p>

<blockquote>
<pre><code>  println(eval("15+20"));
</code></pre>
</blockquote>

<h3>
<a name="error-handling" class="anchor" href="#error-handling"><span class="octicon octicon-link"></span></a>Error handling</h3>

<p>ngscript supports traditional try...catch statements to handle exceptions. These exceptions can be both ngscript's exception object(inner class name VMException) and Java native excetpion(inherited from Exception class).</p>

<blockquote>
<p>The try...catch statement is like this</p>

<pre><code>  try {
          println("will throw excepton");
          throw "exception";
  } catch (e) {
          println(e.toString());
  }
</code></pre>
</blockquote>

<p><code>throw</code> statement throws an object as exception body, the object can be anything(integer, string, or something else).
Catchable Java exceptions can be caught as well, but exceptions such as RuntimeException will not caught by the statement.</p>

<p>The current implementation of the VM catches all unhandled exceptions by default. But it may be useful to throw some of the exceptions to the outer host environment. You can modify the VM by yourself to accomplish this.</p>

<h3>
<a name="coroutine" class="anchor" href="#coroutine"><span class="octicon octicon-link"></span></a>Coroutine</h3>

<p>Coroutine is an useful feature in certain situation. ngscript supports coroutine by providing a class Coroutine.</p>

<blockquote>
<pre><code>  //declare a function first
  function f(a,b) {
          println("first = " + a);
          //call yield to switch to previous
          //and you can passing a retval
          yield(1); 
          //when resume at second time
          //this coroutine will begins at here
          println("second = " + b);
  }

  //create coroutine
  var co = new Coroutine(f, "p1", "p2"); 

  println("coroutine status=" + co.status());
  //call resume to switch to coroutine
  //and will returned with a retval
  println("resume 1 = " + co.resume());
  println("coroutine status=" + co.status());
  //the second resume has nothing returned but garbage
  println("resume 2 = " + co.resume());
  println("coroutine status=" + co.status());
  //when trying to resume a coroutine which is already returned
  //will throw an exception
  try {
          println("resume 3:");
          println(co.resume());
  } catch(e) {
          println("you cannot resume a returned coroutine!");
  }
</code></pre>
</blockquote>

<h2>
<a name="other" class="anchor" href="#other"><span class="octicon octicon-link"></span></a>other</h2>

<h3>
<a name="ngscript-online" class="anchor" href="#ngscript-online"><span class="octicon octicon-link"></span></a>ngscript online</h3>

<p><a href="http://shell.ngscript.org/">http://shell.ngscript.org/</a> is an online version of ngscript.
It is a <strong>REPL</strong> shell, just write your code line, and tap enter to submit.
If you write a valid statement(include expression, while, for, if, etc.), the VM knows it's time to compile and run, then you can see the outputs. Once the compiled code is run to the end, the VM prints the %eax register value.
<strong>If you wrote an incomplete structure and submitted, the prompt will display as <code>...</code>, to tell you continue writing. Only complete syntax structure will trigger a compile-run action.</strong>
It's useful to submit a <code>;</code> (semicolon) to flush the stream, and clear error status.</p>

<p>Tap tab to active completion, the completion feature covers useful commands, and members in current scope.</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/wssccc">wssccc</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>